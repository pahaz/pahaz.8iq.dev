C–æ–±–µ—Ä–µ–º –≤—Å–µ –≤ –µ–¥–∏–Ω—ã–π –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

### 1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `index.html`. –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –º–æ–∂–µ—Ç –Ω–µ –±—ã—Ç—å.

**1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞:** –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏ `KeyManager` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –ø–∞—Ä—ã `IdentityKey`. –í –ø–µ—Ä–≤—ã–π —Ä–∞–∑ —Ç–∞–º –±—É–¥–µ—Ç –ø—É—Å—Ç–æ.

**1.2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è:** –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –ø–∞—Ä—É –∫–ª—é—á–µ–π `IdentityKey` –¥–ª—è —Å–µ–±—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**1.3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ ID:** –ë–µ—Ä–µ–º –ø—É–±–ª–∏—á–Ω—É—é —á–∞—Å—Ç—å `IdentityKey` -> —Å—á–∏—Ç–∞–µ–º SHA-256 -> –ø–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É `xf32...9a` (–Ω–∞—à `IdentityId`).

**1.4. –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–æ—Å–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–≤–µ—Å—Ç–∏ –Ω–∏–∫ `Neo`. –≠—Ç–æ –Ω–∞—à–∞ `IdentityMeta` –≤–∏–¥–∞ `{ username: "Neo" }`.

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å "–õ–∏—á–Ω–æ—Å—Ç—å".

---

### 2. –í—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É (Discovery)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã: `matrix` –∏ –∂–º–µ—Ç "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è".

**2.1. –ü–æ–¥–ø–∏—Å–∫–∞ (—Å–ª—É—à–∞–µ–º —ç—Ñ–∏—Ä):** –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–π —Å–ª–æ–π `MessageTransport` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç—Ä–∏ —Ç–æ–ø–∏–∫–∞:

* `p2p/matrix/discovery` ‚Äî —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –∫—Ç–æ –≤—Ö–æ–¥–∏—Ç/–≤—ã—Ö–æ–¥–∏—Ç.
* `p2p/matrix/messages` ‚Äî —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å —á–∞—Ç (–ø–æ–∫–∞ –Ω–µ –º–æ–∂–µ–º —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å).
* `p2p/matrix/inbox/{–º–æ–π_IdentityId}` ‚Äî —á—Ç–æ–±—ã –º–Ω–µ –º–æ–≥–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å –ª–∏—á–Ω–æ.

**2.2. –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–µ–±—è (ANNOUNCE):** –ú—ã –¥–æ–ª–∂–Ω—ã –∑–∞—è–≤–∏—Ç—å –æ —Å–µ–±–µ. –ú—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–∞–∫–µ—Ç `ANNOUNCE` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –æ–±—â–∏–π —Ç–æ–ø–∏–∫ `p2p/matrix/discovery`:

```js
{
  "type": "ANNOUNCE",
    "msgId": "...",             // –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥—É–±–ª–∏ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤
    "identityKey": "...",       // –ú–æ–π –ü—É–±–ª–∏—á–Ω—ã–π –ö–ª—é—á (—á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –º–æ–≥–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å—å), –ø–æ –Ω–µ–º—É –≤—Å–µ –¥–æ–ª–∂–Ω—ã –ø–æ–ª—É—á–∏—Ç—å –ú–æ–π ID
    "data": "...",              // –ú–æ—è –≤–∏–∑–∏—Ç–∫–∞ '{ "username": "Neo" }' (–ø—É–±–ª–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è).
    "timestamp": 1769191789242, // –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
    "signature": "..."          // –ü–æ–¥–ø–∏—Å—å —ç—Ç–æ–≥–æ –ø–∞–∫–µ—Ç–∞ –º–æ–∏–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–º –∫–ª—é—á–æ–º (–¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —è –≤–ª–∞–¥–µ–ª–µ—Ü ID)
}
```

**2.3. –†–µ–∞–∫—Ü–∏—è "–°—Ç–∞—Ä–æ–∂–∏–ª–æ–≤":** –î–æ–ø—É—Å—Ç–∏–º, –≤ –∫–æ–º–Ω–∞—Ç–µ —É–∂–µ —Å–∏–¥–∏—Ç `Trinity` c `ab12...cd` (`IdentityId`).

* –û–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç `ANNOUNCE` –æ—Ç Neo –∏–∑ `p2p/matrix/discovery`.
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å –∏ –ø–æ–ª—É—á–∞–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Neo –ø–æ –µ–≥–æ –∫–ª—é—á—É.
* –ï–µ `KeyManager` –¥–æ–±–∞–≤–ª—è–µ—Ç Neo –≤ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (—Å—Ç–∞—Ç—É—Å: `New` üî¥). –†–∏—Å—É–µ—Ç –µ–≥–æ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
* **–í–∞–∂–Ω–æ:** Trinity –¥–æ–ª–∂–Ω–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å Neo, –∏–Ω–∞—á–µ –æ–Ω –Ω–µ —É–∑–Ω–∞–µ—Ç, —á—Ç–æ –æ–Ω–∞ –∑–¥–µ—Å—å.
* Trinity –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–π `ANNOUNCE` (—Ç–æ—Ç –∂–µ —Ñ–æ—Ä–º–∞—Ç) –≤ `p2p/matrix/inbox/{Neo_IdentityId}` (–ª–∏—á–Ω–æ –¥–ª—è Neo).

–¢–∞–∫ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–∞—à–µ–≥–æ —á–∞—Ç–∞.

**–ò—Ç–æ–≥:** –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç —Å–ø–∏—Å–æ–∫ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∑–Ω–∞—é—Ç `IdentityId` –∏ `IdentityKey`, –Ω–æ –ø–æ–∫–∞ –Ω–µ –∏–º–µ—é—Ç –æ–±—â–∏—Ö –∫–ª—é—á–µ–π —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.

---

### 3. –†—É–∫–æ–ø–æ–∂–∞—Ç–∏–µ (Handshake 1-to-1)

–≠—Ç–æ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.
–û–Ω –º–æ–∂–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `ANNOUNCE` —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–∏—á–Ω–æ–º index.

–ó–∞–¥–∞—á–∞: –î–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è –æ `SharedSecret` (AES –∫–ª—é—á –¥–ª—è –ª–∏—á–∫–∏).

**3.1. Neo –∫–∏–¥–∞–µ—Ç –º—è—á (INIT)**

Neo –ø–æ–ª—É—á–∏–ª `ANNOUNCE` –æ—Ç Trinity –≤ `p2p/matrix/inbox/{Neo_IdentityId}`
–∏ —Å–ø–µ—à–∏—Ç—å –æ—Ç–≤–µ—Ç–∏—å –Ω–∞ –Ω–µ–≥–æ!

–û–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞—Ä—É –∫–ª—é—á–µ–π ECDH `myEphemeral`. –û—Ç–ø—Ä–∞–≤–ª—è—è –ø–∞–∫–µ—Ç `p2p/matrix/inbox/{Trinity_IdentityId}`:

```js
{
  "type": "HANDSHAKE_INIT",
    "msgId": "...",
    "identityId": "xf32...9a",
    "ephemeralKey": "...",       // –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–ª—é—á
    "timestamp": 1769191789243,
    "signature": "..."           // –ü–æ–¥–ø–∏—Å—å –ø–∞–∫–µ—Ç–∞ –í–ï–ß–ù–´–ú IdentityKey
}
```

**3.2. Trinity –ª–æ–≤–∏—Ç –º—è—á (REPLY)**

* Trinity –ø–æ–ª—É—á–∞–µ—Ç –ø–∞–∫–µ—Ç –≤ —Å–≤–æ–µ–º –∏–Ω–±–æ–∫—Å–µ `p2p/matrix/inbox/{Trinity_IdentityId}`.
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å Neo.
* –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞—Ä—É ECDH (`trinityEphemeral`).
* –í—ã—á–∏—Å–ª—è–µ—Ç `SharedSecret` (—Å–º–µ—Å—å `myEphemeral` + `trinityEphemeral`). –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ `KeyManager` –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å Neo.
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç Neo –≤ `p2p/matrix/inbox/{Neo_IdentityId}`:

```js
{
  "type": "HANDSHAKE_REPLY",
    "msgId": "...",
    "identityId": "ab12...cd",
    "ephemeralKey": "...",       // –í—Ä–µ–º–µ–Ω–Ω—ã–π –∫–ª—é—á Trinity
    "timestamp": 1769191789244,
    "signature": "..."
}
```

**3.3. Neo –∏ Trinity —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Å–≤—è–∑—å**

* Neo –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å.
* –í—ã—á–∏—Å–ª—è–µ—Ç —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π `SharedSecret`.
* –°—Ç–∞—Ç—É—Å Trinity –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –º–µ–Ω—è–µ—Ç—Å—è (—Å—Ç–∞—Ç—É—Å: `Connected` üü°).

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º Neo –∏ Trinity –∏–º–µ—é—Ç –æ–±—â–∏–π `SharedSecret` –∏ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å P2P —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

### 4. –û–±–º–µ–Ω –∫–ª—é—á–∞–º–∏ —á–∞—Ç–∞ (Sender Key Distribution)

Neo –∏ Trinity —Å–∏–¥—è—Ç –≤ –æ–±—â–µ–π –∫–æ–º–Ω–∞—Ç–µ, –æ–Ω–∏ –∑–Ω–∞—é, —á—Ç–æ —Å–∫–æ—Ä–æ —Ç—É–¥–∞ –ø—Ä–∏–¥–µ—Ç Morpheus –∏ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –∏—Ö –¥–∏–∞–ª–æ–≥.
–ß—Ç–æ–±—ã —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ –º–æ–≥–ª–∏ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º, –∫–æ–º—É –¥–æ–≤–µ—Ä—è–µ—à—å `SenderKey`.

Neo –º–æ–∂–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å Trinity —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –≤—ã—è—Å–Ω–∏—Ç—å —Å—Ç–æ–∏—Ç –ª–∏ –µ–π –¥–æ–≤–µ—Ä—è—Ç—å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—Ç–∏—Ç—å Trinity –∫–∞–∫ –≤–µ—Ä–µ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å–≤–µ—Ä–∏–≤ SAS —ç–º–æ–¥–∑–∏, –Ω—É –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç—å –æ–ø—Ü–∏—é TrustAll, —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–≤–µ—Ä—è—Ç—å –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

* –ü–æ—Å–ª–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Å—Ç–∞—Ç—É—Å Trinity –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `Verified` üü¢. –ù—É –∏–ª–∏ –Ω–∞ `Blocked` üî¥, –µ—Å–ª–∏ Neo –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç `IdentityKey` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–º—É Trinity –∏–ª–∏ –µ–µ SAS.

**4.1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Sender Key (–ú–∏–∫—Ä–æ—Ñ–æ–Ω):** –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∫–æ–º–Ω–∞—Ç—É Neo —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª —Å–ª—É—á–∞–π–Ω—ã–π AES –∫–ª—é—á `NeoRoomKey123`. –ò–º –æ–Ω –±—É–¥–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–±—â–µ–º —á–∞—Ç–µ. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏, –æ–Ω –±—É–¥–µ—Ç –µ–≥–æ –æ–±–Ω–æ–≤–ª—è—Ç—å, –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ —Ç–∞–∫–∞—è –æ–ø—Ü–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

**4.2. –†–∞—Å—Å—ã–ª–∫–∞ –∫–ª—é—á–∞:** Neo —Å–¥–µ–ª–∞–ª HANDSHAKE —Å Trinity –∏ –æ—Ç–º–µ—Ç–∏–ª –µ—ë –∫–∞–∫ `Verified` üü¢ –∏ —Ç–µ–ø–µ—Ä—å –æ–Ω –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–¥–∞—Ç—å –µ–π —Å–≤–æ–π `NeoRoomKey123` (SenderKey), —á—Ç–æ–±—ã –æ–Ω–∞ –º–æ–≥–ª–∞ —á–∏—Ç–∞—Ç—å –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–±—â–µ–º —á–∞—Ç–µ.

* Neo –±–µ—Ä–µ—Ç `NeoRoomKey123`.
* –®–∏—Ñ—Ä—É–µ—Ç –µ–≥–æ —Å –ø–æ–º–æ—â—å—é **SharedSecret** (–∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–ª–∏ –Ω–∞ —à–∞–≥–µ 3).
* –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞–∫–µ—Ç –≤ `p2p/matrix/inbox/{Trinity_IdentityId}`:

```js
{
  "type": "SENDER_KEY_SHARE",
    "msgId": "...",
    "identityId": "xf32...9a",
    "encryptedSenderKey": "..."         // –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π SharedSecret SenderKey
  "timestamp": 1769191789245,
}
```

Trinity –¥–µ–ª–∞–µ—Ç —Ç–æ –∂–µ —Å–∞–º–æ–µ ‚Äî –ø—Ä–∏—Å—ã–ª–∞–µ—Ç Neo —Å–≤–æ–π `TrinitySenderKey321` (`SenderKey`) —Ç–∫ –æ–Ω–∞ —Ç–æ–∂–µ –æ—Ç–º–µ—Ç–∏–ª–∞ –µ–≥–æ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º.

**–ò—Ç–æ–≥:** –£ Neo –≤ `KeyManager` –µ—Å—Ç—å —Å–≤—è–∑–∫–∞: `Trinity_IdentityId -> TrinitySenderKey321`.
–¢–µ–ø–µ—Ä—å –æ–Ω –º–æ–∂–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞—Ç—å –≤—Å—ë, —á—Ç–æ –æ–Ω–∞ –ø–∏—à–µ—Ç –≤ –æ–±—â–∏–π —á–∞—Ç.

---

### 5: –û–±—â–µ–Ω–∏–µ (Messaging)

5.1. Neo –ø–∏—à–µ—Ç: "Follow the white rabbit" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∏ –Ω–∞–∂–∏–º–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.

**5.2. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** –°–∏—Å—Ç–µ–º–∞ –±–µ—Ä–µ—Ç `NeoRoomKey123` (`SenderKey`) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.

**5.3. –û—Ç–ø—Ä–∞–≤–∫–∞:** –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ `p2p/matrix/messages`:

```js
{
  "type": "TEXT_MESSAGE",
    "msgId": "...",
    "identityId": "xf32...9a", // –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ –∑–Ω–∞–ª–∏, –∫–∞–∫–æ–π –∫–ª—é—á –∏—Å–∫–∞—Ç—å
    "payload": "...",          // –®–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    "timestamp": 1769191789246,
}
```

**5.4. –ü–æ–ª—É—á–µ–Ω–∏–µ (–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Trinity):**

* Trinity –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ–±—â–µ–º —Ç–æ–ø–∏–∫–µ.
* –°–º–æ—Ç—Ä–∏—Ç "xf32...9a" (`identityId`).
* –ò–¥–µ—Ç –≤ `KeyManager`, –∏—â–µ—Ç –∫–ª—é—á –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ ID.
* –ù–∞—Ö–æ–¥–∏—Ç `NeoRoomKey123`.
* –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç.
* –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ —á–∞—Ç–µ.

**–ê —á—Ç–æ –≤–∏–¥–∏—Ç Morpheus (–∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ –∑–∞—à–µ–ª –∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–ª Handshake)?** –û–Ω –≤–∏–¥–∏—Ç "üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" –≤ –æ–±—â–µ–º —á–∞—Ç–µ. –í–µ–¥—å —É –Ω–µ–≥–æ –ø–æ–∫–∞ –Ω–µ—Ç `SenderKey` –∫–ª—é—á–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π Neo. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –æ–Ω –ø—Ä–æ–≤–µ–¥–µ—Ç Handshake –∏ Neo –¥–æ–±–∞–≤–∏—Ç –µ–≥–æ –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ, Morpheus —Å–º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
